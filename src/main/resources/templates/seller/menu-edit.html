<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:replace="~{./seller/template/base :: layout(~{::title}, ~{::section}, ~{::style}, ~{::script})}">

<head>
	<title>모바일 키오스크</title>
</head>
<style>
</style>
<body style="margin-top: 50px; margin-left: 10px; margin-right: 10px; margin-bottom: 50px;">
	<section>
		<div class="container" style="padding-top: 50px;">
			<h1 class="text-center">[[${item.name}]] 수정</h1>
			<div class="row mt-5 justify-content-center">
				<div class="col-md-8">
					<form id="menuDelete" th:method="delete" th:action>
						<button type="button" class="btn-close" style="CURSOR:hand; float: right;" title="메뉴 삭제"
						onclick="delete_menu()"></button>
					</form>
					<form id="menuAdd" method="post" th:action="|/menus/*{id}|" enctype="multipart/form-data" th:object="${item}">
						<div class="row">
							<div class="col-md-8">
								<input type="text" class="form-control" hidden="true" th:field="*{id}">
								<div class="mb-3">
									<label for="name" class="col-form-label">제품명</label>
									<input type="text" class="form-control" id="name" th:field="*{name}">
								</div>
								<div class="mb-3">
									<label for="price" class="col-form-label">가격</label>
									<input type="text" class="form-control" id="price" th:field="*{price}">
								</div>
							</div>
							<div class="col-md-1"></div>
							<div class="col-md-2">
								<div class="">
									<input type="checkbox" id="visible" th:field="*{visible}" class="form-check-input">
									<label for="visible" class="form-check-label">판매 여부</label>
								</div>
								<div class="mt-3 " style="width: 10vw; height: 10vw;">
									<img th:if="*{image == null}" id="img" src="/img/logo.png" alt="이미지" style="width: 100%; height: 100%;" border="2">
									<img th:if="*{image != null}" id="img" th:src="|/menus/images/*{image}|" alt="이미지" style="width: 100%; height: 100%;" border="2">
									<button th:if="${item.image != null}" type="button" class="btn text-center" style="width: 10vw;" onclick="delete_img();">이미지 삭제</button>
								</div>
							</div>
						</div>
						<div class="mb-3">
							<label for="shortDescription" class="col-form-label">짧은 메뉴 소개</label>
							<input type="text" class="form-control" id="shortDescription" th:field="*{shortDescription}">
						</div>
						<div class="mb-3">
							<label for="description" class="col-form-label">메뉴 설명</label>
							<textarea class="form-control" id="description" th:field="*{description}"></textarea>
						</div>
						<input type="text" hidden="true" name="categoryName" th:value="${category}">
						<input type="file" th:field="*{image}" accept="image/*" onchange="setThumbnail(event);"/>
					</form>

<!--					이미지 제거용 폼-->
					<form id="imgDelete" th:if="${item.image != null}" th:method="delete" th:action="@{/menus/{id}/image(id=${item.id})}">
					</form>

					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" onclick="location.href='/menus'">취소</button>
						<button type="submit" form="menuAdd" class="btn btn-primary">확인</button>
					</div>
				</div>
			</div>
		</div>
	</section>
<script>
	function setThumbnail(event) {
		var reader = new FileReader();
		var input = document.getElementById('image');

		reader.onload = function(event) {
			var img = document.getElementById('img')
			img.setAttribute("src", event.target.result);
		};
		if (event.target.files[0].size > 1000 * 1024) {
			alert("파일이 너무 큽니다. 1024000 보다 작은 파일을 사용하세요. \n" +
					"현재 이미지 사이즈 " + event.target.files[0].size);
			input.value = null;
			img.setAttribute("src", "/img/logo.png");
			return;
		}
		reader.readAsDataURL(event.target.files[0]);
	}

	function delete_img(){
		if (confirm("이미지를 삭제하시겠습니까?") == true){
			document.getElementById('imgDelete').submit();
		}else{
			return;
		}
	}

	function delete_menu(){
		if (confirm("메뉴를 삭제하시겠습니까?") == true){
			document.getElementById('menuDelete').submit();
		}else{
			return;
		}
	}
</script>
</body>
</html>